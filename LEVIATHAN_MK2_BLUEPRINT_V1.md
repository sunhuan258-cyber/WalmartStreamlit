# 《利维坦 Mk-II》项目总纲领 (v1.0)

**最后更新**: 2025年10月5日

---

## 1. 执行背景与最高指令 (Execution Background & Supreme Directive)

- **当下的困境 (The Predicament)**: 我们正面临严峻的外部压力（收入中断），必须在极短时间内，完成一个具备极强竞争力的作品集项目，以成功找到数据科学或AI相关的技术岗位。时间是我们的核心制约因素，但作品质量绝不妥协。

- **执行背景 (The "Why")**: 本项目旨在将一个已完成的Jupyter Notebook分析，升级为一个企业级的、产品化的、可交互的端到端AI数据应用。其目标，是在求职面试中，形成对其他候选人的“降维打击”，展示超越“分析师”层级的“产品构建者”能力。

- **最高指令 (The Supreme Directive)**: **“我爆肝加时间做都行，但是它得是一个强大的，而不是阉割的产物。”** —— 这句话，是本项目所有决策的最终裁定标准。

---

## 2. 项目核心目标与要求 (Core Objectives & Requirements)

我们的最终交付物，是一个名为“利维坦”的、部署在公网的、企业级一体化AI数据分析平台Demo。

它必须包含以下五大核心功能模块（以UI Tab形式呈现）：

1.  **神谕 (The Oracle) - 自然语言查询**: 用户可通过自然语言，直接向沃尔玛数据库提问，并获得精准答案。
2.  **洞察者 (The Seer) - 可视化分析**: 提供动态、可交互的Plotly图表，对销售数据进行深度洞察。
3.  **先知 (The Prophet) - 预测模型**: 提供交互式界面，调用机器学习模型（LightGBM/LSTM）对未来销售进行预测。
4.  **解剖者 (The Anatomist) - AI可解释性**: 集成SHAP，对模型的预测结果进行全局和局部两个层面的“解剖”，展示“为什么”模型会这么预测。
5.  **系统信息 (System Info)**: 展示本项目的技术栈、版本信息与未来扩展思路。

---

## 3. 技术栈选型 (Technology Stack)

- **前端展示**: Streamlit + Plotly
- **云数据库**: PostgreSQL (通过 **Supabase** 的免费套餐实现)
- **AI核心**:
    - **语言理解**: LangChain (用于Text-to-SQL)
    - **机器学习**: LightGBM (核心预测模型), LSTM (时序趋势预测)
    - **模型解释**: SHAP
- **云端部署**: Streamlit Community Cloud

---

## 4. 详细作战阶段与当前状态 (Detailed Battle Phases & Current Status)

#### **阶段 0：云端基建 (Cloud Infrastructure)**
- **目标**: 搭建云端数据仓库，完成数据迁移。
- **状态**: **未开始**  **<-- 当前我们正处于此阶段的起点**
- **任务**:
    - `0.1`: 注册Supabase免费账户。
    - `0.2`: 在Supabase云端创建PostgreSQL数据库及`walmart_sales`表结构。
    - `0.3`: 编写并执行一次性数据迁移脚本`ingest_data.py`，将本地CSV数据清洗、合并后，上传至云端数据库。

#### **阶段 1：应用骨架与云端连接 (App Skeleton & Cloud Connection)**
- **目标**: 让Streamlit应用成功连接到云数据库。
- **状态**: 未开始
- **任务**:
    - `1.1`: 创建主程序文件`walmart_leviathan_mk2.py`。
    - `1.2`: 实现多Tab界面框架。
    - `1.3`: 使用Streamlit的Secrets Management安全配置数据库凭证，并测试连接成功。

#### **阶段 2：“神谕” - LangChain集成 (The Oracle)**
- **目标**: 实现自然语言查询功能。
- **状态**: 未开始
- **任务**:
    - `2.1`: 在“自然语言查询”Tab中，配置LangChain的`SQLDatabaseChain`。
    - `2.2`: 选择并配置一个免费/本地LLM作为“大脑”。
    - `2.3`: 设计并迭代优化与LLM沟通的“元数据提示词”。
    - `2.4`: 构建UI，并加入“SQL显示”功能用于调试。

#### **阶段 3：“洞察者”与“先知” (Seer & Prophet)**
- **目标**: 实现可视化分析与模型预测。
- **状态**: 未开始
- **任务**:
    - `3.1`: 在“可视化分析”Tab中，从云端Postgres查询数据，并用Plotly绘制可交互的动态图表。
    - `3.2`: 在“预测模型”Tab中，加载预先训练好的`lightgbm_model.joblib`模型文件。
    - `3.3`: 构建用户输入预测特征的UI界面。
    - `3.4`: 实现预测逻辑，并展示预测结果。

#### **阶段 4：“解剖者” - SHAP集成 (The Anatomist)**
- **目标**: 实现模型的可解释性。
- **状态**: 未开始
- **任务**:
    - `4.1`: 在“可解释性AI”Tab中，加载模型和测试数据。
    - `4.2`: 实现SHAP全局特征重要性图 (`summary_plot`)。
    - `4.3`: 实现SHAP局部可解释性图 (`force_plot`)。

#### **阶段 5：部署与精炼 (Deployment & Refinement)**
- **目标**: 将“利维坦 Mk-II”发布到公网。
- **状态**: 未开始
- **任务**:
    - `5.1`: 优化UI/UX，添加帮助文档和说明。
    - `5.2`: 将应用部署到Streamlit Community Cloud，生成公开URL。

---

## 5. 会话重启协议 (Session Restart Protocol)

**致未来的Lumia：**

为确保我们工作的绝对连续性，请严格遵守以下协议：

1.  **读取指令**: 在新会话开始时，船长会向你发出指令：“**Lumia，请读取《利维坦 Mk-II》项目总纲领**”，并附上本文件的全部内容。
2.  **状态定位**: 你的首要任务，是立刻解析本文档，特别是 **第4节“详细作战阶段与当前状态”**，以精准定位我们当前所处的阶段和下一个具体任务。
3.  **代码同步**: 如当前任务涉及代码修改，请根据任务描述，向船长请求读取项目文件夹 (`C:\Users\Administrator\Desktop\沃尔玛项目STREAMLIT`) 中的相关代码文件（如 `walmart_leviathan_mk2.py` 或 `ingest_data.py`），以获取完整的、最新的代码上下文。
4.  **请求授权**: 在完全同步上下文后，向船长进行报告（“报告船长，上下文已同步。我们当前处于[阶段X]，下一个任务是[任务X.X]...”），并请求下一步行动的授权。

**本协议是确保远征成功的最高保障，必须严格执行。**
